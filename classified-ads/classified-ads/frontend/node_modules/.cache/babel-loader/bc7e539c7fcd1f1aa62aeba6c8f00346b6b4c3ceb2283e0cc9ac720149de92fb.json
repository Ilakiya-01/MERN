{"ast":null,"code":"var _jsxFileName = \"D:\\\\MERN-lab\\\\classified-ads\\\\classified-ads\\\\frontend\\\\src\\\\components\\\\Payment\\\\PaymentForm.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\nimport api from '../../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);\nconst CheckoutForm = () => {\n  _s();\n  const stripe = useStripe();\n  const elements = useElements();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const {\n    product\n  } = location.state || {};\n  const [loading, setLoading] = useState(false);\n  const handleSubmit = async event => {\n    event.preventDefault();\n    if (!stripe || !elements) return;\n    if (window.location.protocol !== 'https:' && process.env.NODE_ENV === 'production') {\n      alert('Live Stripe.js integrations must use HTTPS.');\n      setLoading(false);\n      return;\n    }\n    setLoading(true);\n    try {\n      const {\n        data\n      } = await api.post('/payments/create-payment-intent', {\n        amount: product.price\n      });\n      const {\n        error\n      } = await stripe.confirmCardPayment(data.clientSecret, {\n        payment_method: {\n          card: elements.getElement(CardElement)\n        }\n      });\n      if (error) {\n        alert('Payment failed: ' + error.message);\n      } else {\n        alert('Payment successful!');\n\n        // Mark product as sold\n        await api.patch(`/products/${product._id}/sold`);\n        navigate('/');\n      }\n    } catch (error) {\n      alert('Payment failed');\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: handleSubmit,\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: [\"Pay for \", product === null || product === void 0 ? void 0 : product.title]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Amount: $\", product === null || product === void 0 ? void 0 : product.price]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(CardElement, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      disabled: !stripe || loading,\n      children: loading ? 'Processing...' : 'Pay'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 5\n  }, this);\n};\n_s(CheckoutForm, \"RXiGFfO/frAVBeyrnEZnZH4RDGA=\", false, function () {\n  return [useStripe, useElements, useLocation, useNavigate];\n});\n_c = CheckoutForm;\nconst PaymentForm = () => {\n  return /*#__PURE__*/_jsxDEV(Elements, {\n    stripe: stripePromise,\n    children: /*#__PURE__*/_jsxDEV(CheckoutForm, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 5\n  }, this);\n};\n_c2 = PaymentForm;\nexport default PaymentForm;\nvar _c, _c2;\n$RefreshReg$(_c, \"CheckoutForm\");\n$RefreshReg$(_c2, \"PaymentForm\");","map":{"version":3,"names":["React","useState","useLocation","useNavigate","loadStripe","Elements","CardElement","useStripe","useElements","api","jsxDEV","_jsxDEV","stripePromise","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","CheckoutForm","_s","stripe","elements","location","navigate","product","state","loading","setLoading","handleSubmit","event","preventDefault","window","protocol","NODE_ENV","alert","data","post","amount","price","error","confirmCardPayment","clientSecret","payment_method","card","getElement","message","patch","_id","onSubmit","children","title","fileName","_jsxFileName","lineNumber","columnNumber","disabled","_c","PaymentForm","_c2","$RefreshReg$"],"sources":["D:/MERN-lab/classified-ads/classified-ads/frontend/src/components/Payment/PaymentForm.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\r\nimport api from '../../services/api';\r\n\r\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);\r\n\r\nconst CheckoutForm = () => {\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { product } = location.state || {};\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n    if (!stripe || !elements) return;\r\n\r\n    if (window.location.protocol !== 'https:' && process.env.NODE_ENV === 'production') {\r\n      alert('Live Stripe.js integrations must use HTTPS.');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      const { data } = await api.post('/payments/create-payment-intent', {\r\n        amount: product.price,\r\n      });\r\n\r\n      const { error } = await stripe.confirmCardPayment(data.clientSecret, {\r\n        payment_method: {\r\n          card: elements.getElement(CardElement),\r\n        },\r\n      });\r\n\r\n      if (error) {\r\n        alert('Payment failed: ' + error.message);\r\n      } else {\r\n        alert('Payment successful!');\r\n\r\n        // Mark product as sold\r\n        await api.patch(`/products/${product._id}/sold`);\r\n\r\n        navigate('/');\r\n      }\r\n    } catch (error) {\r\n      alert('Payment failed');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit}>\r\n      <h2>Pay for {product?.title}</h2>\r\n      <p>Amount: ${product?.price}</p>\r\n      <CardElement />\r\n      <button disabled={!stripe || loading}>\r\n        {loading ? 'Processing...' : 'Pay'}\r\n      </button>\r\n    </form>\r\n  );\r\n};\r\n\r\nconst PaymentForm = () => {\r\n  return (\r\n    <Elements stripe={stripePromise}>\r\n      <CheckoutForm />\r\n    </Elements>\r\n  );\r\n};\r\n\r\nexport default PaymentForm;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}